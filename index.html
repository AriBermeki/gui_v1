<html>
  <head>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, sans-serif;
        background: #f0f2f5;
        margin: 0;
        padding: 2rem;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      .card {
        background: white;
        border-radius: 1rem;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        padding: 2rem;
        width: 350px;
        text-align: center;
      }

      h2 {
        margin-bottom: 1rem;
        color: #333;
      }

      .input-group {
        margin: 1rem 0;
        text-align: left;
      }

      label {
        display: block;
        margin-bottom: 0.3rem;
        font-size: 0.9rem;
        color: #555;
      }

      input {
        width: 100%;
        padding: 0.8rem;
        border: 1px solid #ccc;
        border-radius: 0.5rem;
        font-size: 1rem;
      }

      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 0.8rem 1.2rem;
        margin-top: 1rem;
        border-radius: 0.5rem;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.3s;
        width: 100%;
      }

      button:hover {
        background: #0056b3;
      }

      .message {
        margin-top: 1rem;
        font-size: 0.95rem;
        color: #007bff;
        font-weight: 500;
      }
    </style>
  </head>

  <body>
    <div class="card">
      <h2>User Login</h2>
      <div class="input-group">
        <label for="username">Username</label>
        <input id="username" type="text" placeholder="Enter your username" />
      </div>
      <div class="input-group">
        <label for="password">Password</label>
        <input
          id="password"
          type="password"
          placeholder="Enter your password"
        />
      </div>
      <button onclick="submitForm()">Login</button>
      <div id="msg" class="message"></div>
    </div>

    <script>
      function submitForm() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        payload = JSON.stringify({ action: "login", username, password });
        window.ipc.postMessage(payload);
        document.getElementById("msg").innerText = "Sending login request...";
      }

      function uid() {
        return window.crypto.getRandomValues(new Uint32Array(1))[0].toString();
      }

      function transformCallback(callback, once = true) {
        const identifier = uid();
        const prop = `_${identifier}`;

        Object.defineProperty(window, prop, {
          value: (result) => {
            if (once) Reflect.deleteProperty(window, prop);
            if (callback) callback(result);
          },
          writable: false,
          configurable: true,
        });

        return identifier;
      }

      function invoke(cmd, args = []) {
        return new Promise((resolve, reject) => {
          if (!window.ipc || typeof window.ipc.postMessage !== "function") {
            reject(new Error("IPC bridge is not available!"));
            return;
          }

          const result_id = transformCallback(
            (result) => resolve(result),
            true
          );
          const error_id = transformCallback((error) => reject(error), true);

          const message = {
            cmd,
            result_id,
            error_id,
            payload: args, // args as list (matches Python dispatch)
          };

          window.ipc.postMessage(message);
        });
      }
    </script>
  </body>
</html>
